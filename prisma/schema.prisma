generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  brand       String
  scale       String
  price       String

  // THE KEY CHANGE: We store a list of URLs, not just one
  images      String[] 
  video       String? 

  description String?
  editorsNote String?
  material    String?
  condition   String?

  featured    Boolean  @default(false)
  collectionStatus CollectionStatus @default(ARCHIVE_CATALOG)
  genre       Genre?
  modelYear   Int?
  isRare      Boolean  @default(false)
  stock       Int      @default(1)
  orderItems  OrderItem[]
  wishlist    WishlistItem[]
  createdAt   DateTime @default(now())
}

model User {
  id                String   @id // Clerk User ID
  collectorName     String?
  bio               String?
  stamp             String?
  fontPreference    String?
  progressRingColor String?
  theme             String?  @default("dark")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Order {
  id             String @id @default(cuid())

  // Associates order with a user from Clerk, optional for guest checkouts
  userId         String?

  firstName      String
  lastName       String
  email          String
  phone          String
  address        String
  city           String
  postalCode     String
  country        String
  shippingMethod String
  trackingNumber String?
  shippingCost   Float       @default(0)
  total          Float
  status         String      @default("PENDING") // Fulfillment status: PENDING, SHIPPED, DELIVERED
  items          OrderItem[]

  // Payment-related fields
  paymentStatus     String  @default("UNPAID") // UNPAID, PAID, FAILED
  razorpayOrderId   String? @unique
  razorpayPaymentId String? @unique
  razorpaySignature String?

  createdAt DateTime @default(now())
}



model OrderItem {

  id        String @id @default(cuid())
  name      String
  price     Float
  quantity  Int
  image     String
  order     Order  @relation(fields: [orderId], references: [id])
  orderId   String

  product   Product @relation(fields: [productId], references: [id])
  productId String
  nickname  String?

}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String   // Clerk User ID
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  nickname  String?  // e.g., "The Grail"
  createdAt DateTime @default(now())
}

model JournalEntry {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String
  author      String?
  genre       Genre?
  isPublished Boolean  @default(false)
  isFeatured  Boolean  @default(false) // NEW FIELD: Tracks the hero slot
  readTime    Int?     // NEW FIELD: Stores the "Est. Lap Time"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  images      String[]
  video       String?
}

enum CollectionStatus {
  ARCHIVE_CATALOG
  NEW_ARRIVAL
  FEATURED_EXHIBIT
}

enum Genre {
  CLASSIC_VINTAGE
  RACE_COURSE
  CITY_LIFE
  SUPERPOWERS
  LUXURY_REDEFINED
  OFF_ROAD
  FUTURE_PROOF
}
